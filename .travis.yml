dist: trusty
sudo: required

auth: &Auth |
  npm i -g travis-env && eval "$(travis-env)"
  echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

jobs:
  include:
    - stage: build
    - name: "Build latest tag"
    - script:
      - *Auth
      - docker build . -t eventology/alpine-node:latest
      - docker push eventology/alpine-node:latest
    - stage: build_vips
    - name: "Build vips tag"
    - script:
      - *Auth
      - docker build -t eventology/alpine-node:vips -f ./vips/Dockerfile .
      - docker push eventology/alpine-node:vips

stages:
  - build
