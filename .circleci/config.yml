docker_login: &DockerLogin |
  echo $DOCKER_PASSWORD | docker login -u $DOCKER_LOGIN --password-stdin

version: 2
jobs:
  build:
    machine: true
    steps:
      - checkout
      - run: *DockerLogin
      - run: docker build . -t eventology/alpine-node:latest
      - run: docker push eventology/alpine-node:latest
  build_vips:
    machine: true
    steps:
      - checkout
      - run: *DockerLogin
      - run: docker build -t eventology/alpine-node:vips -f ./vips/Dockerfile .
      - run: docker push eventology/alpine-node:vips
workflows:
  version: 2
  build:
    jobs:
      - build:
          context: org-global
          filters:
            branches:
              only: master
      - build_vips:
          context: org-global
          filters:
            branches:
              only: master
